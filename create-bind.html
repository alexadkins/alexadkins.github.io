<!DOCTYPE html>
<html>
	<head>
		<title>Create Bind</title>
		<link rel="stylesheet" href="css/bootstrap.min.css">
		<link rel="stylesheet" href="css/bootstrap-theme.min.css">
		<link rel="stylesheet" href="css/jquery-ui.structure.min.css">
		<link rel="stylesheet" href="css/jquery-ui.theme.min.css">
		<link rel="stylesheet" href="css/main.css">
		<link href="https://fonts.googleapis.com/css?family=Open+Sans|Raleway" rel="stylesheet">

		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
	</head>

	<body>
		<div class="container">
			<div class="page-header">
				<h2> Create Node Relationship </h2>
			</div>

			<div class="row">
				<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
					<h4>Choose Node</h4>
					<div class="ui-widget">
						<label for="select-node">Nodes: </label>
						<input id="select-node">
					</div>
				</div>
			</div>

			<div class="row">
				<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
					<h4>Choose Well</h4>
					<div class="ui-widget">
						<label for="select-well">Wells: </label>
						<input id="select-wel">
					</div>
				</div>
			</div>

			<div class="row">
				<div class="col-xs-12 col-sm-12 col-md-2 col-lg-3"></div>
				<div class="col-xs-12 col-sm-12 col-md-8 col-lg-6">
					<div id="map"></div>
				</div>
				<div class="col-xs-12 col-sm-12 col-md-2 col-lg-3"></div>
			</div>

			<div class="row">
				<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
					<div class="button"> Save</div>
				</div>
			</div>



		</div>	

		<script src="js/jquery-3.1.1.min.js"></script>
		<script src="js/bootstrap.min.js"></script>
		<script src="js/jquery-ui.min.js"></script>

		<script>
			// Retrieve and modify wells json
			var autocompleteWellsData = [];
			// var mapsWellsJSON;
			// var wellsJSON = 


			function handleLocationError(browserHasGeolocation, infoWindow, pos) {
				infoWindow.setPosition(pos);
				infoWindow.setContent(browserHasGeolocation ? 
															'Error: The geolocation service failed.': 
															'Error: Your browser doesn\'t support geolocation.');
			}

			function selectMarker() {
				console.log("click marker!");
			};

			function initMap() {
				var myLatLng = {lat: -35.113186, lng: 173.263392};

				var map = new google.maps.Map(document.getElementById('map'), {
					zoom: 4,
					center: myLatLng
				});

				var infoWindow = new google.maps.InfoWindow({map: map});

				// var marker = new google.maps.Marker({
				// 	position: myLatLng,
				// 	map: map,
				// 	title: 'Hello World!',
				// 	label: "Well 1"
				// });

				marker.addListener('click', function() {selectMarker()});

				$.getJSON("data/wells.json", function(data) {
					$.each(data, function(index, element) {
						console.log("index");
						console.log(index);
						console.log("element");
						console.log(element);
						autocompleteWellsData.push({"label": element["label"], "value": element["value"]})

						var marker = new google.maps.Marker({
							position: {lat: element["lat"], lng: element["lng"]},
							map: map,
							label: element["label"]
						})
					})
					console.log("jsonData: ");
					console.log(data);
				});

				// Find user's current location
				if (navigator.geolocation) {
					navigator.geolocation.getCurrentPosition(function(position) {
						var pos = {
							lat: position.coords.latitude,
							lng: position.coords.longitude
						};

						infoWindow.setPosition(pos);
						infoWindow.setContent('Your location.');
					}, function() {
						handleLocationError(true, infoWindow, map.getCenter())	
					});
				} else {
					handleLocationError(false, infoWindow, map.getCenter())
				}

			};

			// Autocomplete for node input
			$("#select-node").autocomplete({
				source: "data/nodes.json"
			});

			$("#select-well").autocomplete({
				source: autocompleteWellsData
			});

		</script>
		<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDpwGGT0KzQlw5WYKNJ5CBzSgPCyh4W44c&callback=initMap"></script>
	</body>
</html>